<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Sign Up - Venti</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/auth.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="auth-body">
    <div class="auth-bg"></div>

    <div class="signup-card">
        <div class="brand">
            <span class="ven">VEN</span><span class="ti">TI</span>
        </div>

        <h1 class="title">Complete your signup</h1>
        <p class="subtitle">We pulled details from Google. You can edit before continuing.</p>

        <div class="profile-preview">
            <div class="avatar">
                {% if account and account.get_avatar_url %}
                    <img src="{{ account.get_avatar_url }}" alt="Avatar">
                {% elif sociallogin and sociallogin.account and sociallogin.account.get_avatar_url %}
                    <img src="{{ sociallogin.account.get_avatar_url }}" alt="Avatar">
                {% else %}
                    <div class="avatar-fallback">
                        <span class="material-icons">account_circle</span>
                    </div>
                {% endif %}
            </div>
            <div class="profile-text">
                <div class="name-line">
                    <span class="material-icons">badge</span>
                    <span>
                        {% if account and account.extra_data.name %}{{ account.extra_data.name }}{% elif sociallogin and sociallogin.account and sociallogin.account.extra_data.name %}{{ sociallogin.account.extra_data.name }}{% else %}Google User{% endif %}
                    </span>
                </div>
                <div class="email-line">
                    <span class="material-icons">mail</span>
                    <span>
                        {% if account and account.extra_data.email %}{{ account.extra_data.email }}{% elif sociallogin and sociallogin.account and sociallogin.account.extra_data.email %}{{ sociallogin.account.extra_data.email }}{% else %}{% if form.email.value %}{{ form.email.value }}{% endif %}{% endif %}
                    </span>
                </div>
            </div>
        </div>

        <form method="post" action="">
            {% csrf_token %}

            <div class="field">
                <label for="id_username">Username</label>
                <input id="id_username" name="username" type="text" required
                       value="{% if form.username.value %}{{ form.username.value }}{% else %}{% if account and account.extra_data.given_name %}{{ account.extra_data.given_name|lower }}{% elif sociallogin and sociallogin.account and sociallogin.account.extra_data.given_name %}{{ sociallogin.account.extra_data.given_name|lower }}{% else %}{% endif %}{% endif %}">
                <button type="button" class="btn-ghost" id="use-google-username">
                    <span class="material-icons">auto_fix_high</span> Use Google suggestion
                </button>
            </div>

            <div class="field">
                <label for="id_email">Email</label>
                <input id="id_email" name="email" type="email"
                       value="{% if form.email.value %}{{ form.email.value }}{% else %}{% if account and account.extra_data.email %}{{ account.extra_data.email }}{% elif sociallogin and sociallogin.account and sociallogin.account.extra_data.email %}{{ sociallogin.account.extra_data.email }}{% endif %}{% endif %}">
            </div>

            {% if form.non_field_errors %}
            <div class="form-errors">
                {{ form.non_field_errors }}
            </div>
            {% endif %}

            <div class="actions">
                <button type="submit" class="btn-primary">Continue</button>
                <a href="/students/dashboard/" class="btn-link">Skip for now</a>
            </div>
        </form>

        <div class="legal">
            By continuing, you agree to Venti's <a href="#">Terms</a> and <a href="#">Privacy Policy</a>.
        </div>
    </div>

    <script>
        (function(){
            const suggestName = '{% if account and account.extra_data.given_name %}{{ account.extra_data.given_name|escapejs }}{% elif sociallogin and sociallogin.account and sociallogin.account.extra_data.given_name %}{{ sociallogin.account.extra_data.given_name|escapejs }}{% elif account and account.extra_data.name %}{{ account.extra_data.name|escapejs }}{% elif sociallogin and sociallogin.account and sociallogin.account.extra_data.name %}{{ sociallogin.account.extra_data.name|escapejs }}{% else %}{% endif %}';
            const usernameInput = document.getElementById('id_username');
            const useBtn = document.getElementById('use-google-username');
            if (useBtn) {
                useBtn.addEventListener('click', function(){
                    if (suggestName) {
                        const clean = suggestName.toLowerCase().replace(/[^a-z0-9_]+/g, '').slice(0, 20);
                        if (clean) usernameInput.value = clean;
                    }
                });
            }
        })();
    </script>
</body>
</html>


